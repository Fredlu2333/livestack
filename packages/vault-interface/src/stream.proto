syntax = "proto3";

package livestack;

// import "google/protobuf/struct.proto";
import "google/protobuf/empty.proto"; 

service StreamService {
  rpc Pub(StreamPubMessage) returns (StreamPubResult);
  rpc Sub(SubRequest) returns (stream StreamDatapoint);
  rpc valueByReverseIndex(ValueByReverseIndexRequest) returns (ValueByReverseIndexResponse);
  rpc latestValue(LatestValueRequest) returns (LatestValueResponse);
}


message StreamPubMessage {
  string projectId = 1;
  string uniqueName = 2;
  string dataStr = 3;
}

message StreamPubResult {
  string messageId = 1;
}

enum SubType {
  fromStart = 0;
  fromNow = 1;
}

message SubRequest {
  string projectId = 1;
  string uniqueName = 2;
  SubType subType = 5;
}

message StreamDatapoint {
  uint64 timestamp = 1;
  string messageId = 2;
  string dataStr = 3;
}

message ValueByReverseIndexRequest {
  string projectId = 1;
  string uniqueName = 2;
  uint64 index = 3;
}

message ValueByReverseIndexResponse {
  oneof value {
    StreamDatapoint datapoint = 1;
    google.protobuf.Empty null_response = 2;
  }
}

message LatestValueRequest {
  string projectId = 1;
  string uniqueName = 2;
}

message LatestValueResponse {
  oneof value {
    StreamDatapoint datapoint = 1;
    google.protobuf.Empty null_response = 2;
  }
}
